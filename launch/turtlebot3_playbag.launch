<launch>
  <!-- Arguments -->
  <arg name="model" default="waffle_pi"/>
  <arg name="bag_name" default="fixed_slam_easy"/>

  <!-- Turtlebot3 -->
  <include file="$(find turtlebot3_bringup)/launch/turtlebot3_remote.launch">
    <arg name="model" value="$(arg model)" />
  </include>

  <!-- Map server -->
  <node pkg="map_server" type="map_server" name="map_server" 
      args="/home/ines/robotica/intro_robotics/src/turtlebot3_datasets/data/map.yaml" />


  <!-- TF -->
  <!-- Static TF: connect odom to base_footprint -->
  <node pkg="tf" type="static_transform_publisher" name="groundtruth_tf"
        args="0 0 0 0 0 0 odom base_footprint 100"/>

  <node pkg="tf" type="static_transform_publisher" name="map_to_odom" args="0 0 0 0 0 0 map odom 100"/>


  
  <!-- ROSBAG -->
  <param name="/use_sim_time" value="true"/>
  <!--node pkg="rosbag" type="play" name="rosbag_player" 
          args="clock $(find turtlebot3_datasets)/data/$(arg bag_name).bag"/> -->

  <node pkg="rosbag" type="play" name="rosbag_player" 
      args="--clock /home/ines/robotica/intro_robotics/src/turtlebot3_datasets/data/fixed_slam_easy.bag"/>


  <!-- EKF Localisation Node -->
  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_localization_local">
        <rosparam command="load" file="/home/ines/robotica/intro_robotics/src/turtlebot3_datasets/launch/caca.yaml" />
        <remap from="/odometry/filtered" to="/odometry/filtered" />
    </node>

  <!-- AMCL-->

  <!-- Groundtruth path -->
  <node pkg="turtlebot3_datasets" type="publish_groundtruth_path.py" name="groundtruth_path_publisher" output="screen">
</node>



  <!-- Estimated path -->

  <!-- EKF error logger -->
  <node pkg="turtlebot3_datasets" type="calculate_errors_1hz.py" name="error_calculator" output="screen">
    <param name="gt_topic" value="/groundtruth_path"/>       <!-- subscribe to path instead of odom -->
    <param name="ekf_topic" value="/odometry/filtered"/>    <!-- EKF estimate topic -->
  </node>


  <!-- rviz -->
  <node pkg="rviz" type="rviz" name="rviz" required="true"/>

</launch>